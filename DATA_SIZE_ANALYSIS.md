# 📊 Newturn 데이터 크기 분석 및 인프라 재검토

**작성일**: 2025.01.14  
**목적**: 데이터 크기 분석 및 인프라 아키텍처 적정성 검토

**⚠️ 중요**: 본 문서는 데이터 최적화(삭제/아카이빙) 전략을 포함하고 있으나, 실제 서비스는 **모든 데이터 보존**을 원칙으로 합니다. 데이터 보존 및 판매 전략은 `DATA_BUSINESS_STRATEGY.md`를 참고하세요.

---

## 📈 **현재 데이터 규모**

### **기본 데이터 (공개 데이터, 모든 사용자 공유)**

#### **1. 종목 데이터 (Stock)**
- **현재**: 5,036개 종목
- **데이터 구조**:
  - Ticker, Name, Sector, Industry
  - CIK (10-K 파일 매핑)
  - 시가총액, 발행주식수
- **예상 크기**: ~500 KB (텍스트 데이터)

#### **2. 재무 데이터 (FinancialData)**
- **현재**: 5,036개 종목 × 평균 20분기 = ~100,000개 레코드
- **데이터 구조** (분기별):
  - Revenue, NetIncome, OCF, CAPEX
  - TotalAssets, TotalDebt, ShareholdersEquity
  - SharesOutstanding
- **예상 크기**: 
  - 레코드당 ~200 bytes
  - 100,000 × 200 bytes = **20 MB**

#### **3. 메이트 분석 (MateAnalysis)**
- **현재**: 3,912개 종목
- **데이터 구조** (종목당):
  - 4개 메이트 점수 (Graham, Fisher, Greenblatt, Lynch)
  - 적정가격, 시가총액 대비 평가
  - 계산 일시
- **예상 크기**:
  - 레코드당 ~500 bytes
  - 3,912 × 500 bytes = **2 MB**

#### **4. 주가 데이터 (StockPrice)**
- **현재**: 수집 중 (일별 데이터)
- **데이터 구조** (종목당 일별):
  - Date, Open, High, Low, Close, Volume
- **예상 크기** (1년 기준):
  - 5,000개 종목 × 252 거래일 × 50 bytes = **63 MB/년**
  - 5년 저장 시: **315 MB**

#### **5. 10-K 인사이트 (TenKInsight)**
- **현재**: 14개 종목 (확장 예정)
- **데이터 구조**:
  - AI 생성 텍스트 (평균 5,000자)
  - 요약, 키워드, 인사이트
- **예상 크기**:
  - 종목당 ~10 KB
  - 1,000개 종목 확장 시: **10 MB**

#### **기본 데이터 총계:**
```
종목 데이터:        0.5 MB
재무 데이터:       20 MB
메이트 분석:        2 MB
주가 데이터 (5년): 315 MB
10-K 인사이트:     10 MB
─────────────────────────
합계:             347.5 MB
```

---

### **사용자별 데이터 (개인 데이터)**

#### **1. 사용자 (User)**
- **예상 사용자 수**: 혼자 사용 또는 소규모 (1-10명)
- **데이터 구조**:
  - 이메일, 이름, 구독 정보
- **예상 크기**: 1-10명 × 1 KB = **0.01 MB**

#### **2. 포트폴리오 (Portfolio)**
- **예상**: 1-10개 포트폴리오
- **데이터 구조**:
  - 포트폴리오명, 생성일
- **예상 크기**: 10개 × 1 KB = **0.01 MB**

#### **3. 관심종목 (Watchlist)**
- **예상**: 1-100개 종목
- **데이터 구조**:
  - Stock 외래키, 추가일
- **예상 크기**: 100개 × 100 bytes = **0.01 MB**

#### **4. 투자 시스템 데이터 (CategoryAccount, SavingsReward 등)**
- **예상**: 1-10개 통장, 10-100개 투자
- **데이터 구조**:
  - CategoryAccount: 통장명, 잔액
  - SavingsReward: 투자 금액, 수량, 매수가
  - Transaction: 거래 내역
- **예상 크기**: 
  - 통장 10개 × 2 KB = 0.02 MB
  - 투자 100개 × 1 KB = 0.1 MB
  - 거래 내역 1,000개 × 0.5 KB = 0.5 MB
  - **합계: 0.62 MB**

#### **5. 콘텐츠 큐레이션 (CuratedContent)**
- **예상**: 200-1,000개 콘텐츠
- **데이터 구조**:
  - 제목, URL, 큐레이터 노트 (평균 500자)
- **예상 크기**:
  - 1,000개 × 2 KB = **2 MB**

#### **사용자 데이터 총계 (1명 기준):**
```
사용자:              0.001 MB
포트폴리오:          0.01 MB
관심종목:            0.01 MB
투자 시스템:         0.62 MB
콘텐츠:              2 MB
─────────────────────────
합계 (1명):         2.64 MB
```

#### **10명 사용 시:**
```
개인 데이터:         26.4 MB
기본 데이터:        347.5 MB
─────────────────────────
총계:              373.9 MB
```

---

## 📊 **데이터 증가 속도 분석**

### **연간 증가량**

#### **재무 데이터**
- 분기별 업데이트: 5,000개 종목 × 4분기 = 20,000개 레코드/년
- 증가량: 20,000 × 200 bytes = **4 MB/년**

#### **주가 데이터**
- 일별 업데이트: 5,000개 종목 × 252일 = 1,260,000개 레코드/년
- 증가량: 1,260,000 × 50 bytes = **63 MB/년**

#### **메이트 분석**
- 월별 재계산: 5,000개 종목 × 12개월 = 60,000개 레코드/년
- 증가량: 60,000 × 500 bytes = **30 MB/년**

#### **10-K 인사이트**
- 분기별 생성: 1,000개 종목 × 4분기 = 4,000개/년
- 증가량: 4,000 × 10 KB = **40 MB/년**

#### **총 연간 증가량:**
```
재무 데이터:        4 MB/년
주가 데이터:       63 MB/년
메이트 분석:       30 MB/년
10-K 인사이트:     40 MB/년
─────────────────────────
합계:            137 MB/년
```

---

## 🎯 **인프라 재검토**

### **시나리오별 데이터 크기**

#### **시나리오 1: 혼자 사용 (1명)**
```
초기 데이터:       347.5 MB (기본) + 2.64 MB (개인) = 350 MB
1년 후:           350 MB + 137 MB = 487 MB
2년 후:           487 MB + 137 MB = 624 MB
3년 후:           624 MB + 137 MB = 761 MB
```

#### **시나리오 2: 소규모 (10명)**
```
초기 데이터:       347.5 MB (기본) + 26.4 MB (개인) = 374 MB
1년 후:           374 MB + 137 MB = 511 MB
2년 후:           511 MB + 137 MB = 648 MB
```

#### **시나리오 3: 확장 (100명)**
```
초기 데이터:       347.5 MB (기본) + 264 MB (개인) = 612 MB
1년 후:           612 MB + 137 MB = 749 MB
2년 후:           749 MB + 137 MB = 886 MB
```

---

## ✅ **인프라 적정성 검토**

### **현재 권장 구성: Supabase Free (500MB)**

#### **✅ 적정한 경우:**
- **혼자 사용**: 3-4년 충분 (761 MB까지)
- **소규모 (10명)**: 3-4년 충분
- **확장 (100명)**: 2-3년 충분

#### **⚠️ 한계 도달 시점:**
- **혼자 사용**: 약 4년 후
- **소규모 (10명)**: 약 4년 후
- **확장 (100명)**: 약 2-3년 후

---

## 🔧 **인프라 최적화 전략**

### **전략 1: 데이터 아카이빙 (권장)** ⭐⭐⭐⭐⭐

#### **주가 데이터 아카이빙**
- **현재**: 5년치 주가 데이터 (315 MB)
- **최적화**: 1년치만 유지, 나머지 아카이빙
- **절감량**: 315 MB → 63 MB (**252 MB 절감**)

**구현:**
```python
# 오래된 주가 데이터 삭제 또는 별도 저장
# 1년 이상 된 데이터는 삭제하거나 아카이빙
StockPrice.objects.filter(date__lt=one_year_ago).delete()
```

#### **재무 데이터 최적화**
- **현재**: 모든 분기 데이터 유지
- **최적화**: 연도별 데이터만 유지 (분기 데이터는 최근 2년만)
- **절감량**: 20 MB → 10 MB (**10 MB 절감**)

#### **메이트 분석 최적화**
- **현재**: 모든 계산 이력 유지
- **최적화**: 최신 분석만 유지 (과거 이력 삭제)
- **절감량**: 2 MB → 0.5 MB (**1.5 MB 절감**)

#### **총 절감량:**
```
주가 데이터:       252 MB
재무 데이터:        10 MB
메이트 분석:         1.5 MB
─────────────────────────
합계:            263.5 MB
```

**최적화 후 크기:**
```
기본 데이터:       84 MB (347.5 - 263.5)
1년 증가:         137 MB
─────────────────────────
총계:            221 MB (최적화 후)
```

**결과**: Supabase Free (500MB)로 **10년 이상** 충분! ✅

---

### **전략 2: 데이터 파티셔닝 (고급)**

#### **핫/콜드 데이터 분리**
- **핫 데이터**: 최근 1년 데이터 (Supabase)
- **콜드 데이터**: 오래된 데이터 (S3 또는 로컬 백업)

**비용:**
- S3 스토리지: $0.023/GB/월
- 1GB 저장 시: $0.023/월 (~₩30/월)

---

### **전략 3: 업그레이드 (필요 시)**

#### **Supabase Pro ($25/월)**
- **용량**: 8 GB
- **사용 시점**: 데이터 500MB 초과 또는 백업 필요 시
- **추가 기능**: Point-in-Time Recovery (PITR)

**비용 대비 효과:**
- 8GB = 현재 데이터의 20배
- 20년 이상 충분

---

## 🎯 **최종 권장 인프라**

### **시나리오 1: 혼자 사용 (권장)** ⭐⭐⭐⭐⭐

```
Frontend: Vercel (무료)
Backend: Railway ($5/월)
Database: Supabase Free (500MB)
Redis: Upstash (무료)
총 비용: $5/월

데이터 최적화:
- 주가 데이터: 1년치만 유지 (아카이빙)
- 재무 데이터: 연도별 + 최근 2년 분기
- 메이트 분석: 최신만 유지

예상 사용 기간: 10년 이상
```

### **시나리오 2: 소규모 확장 (10-50명)**

```
Frontend: Vercel (무료)
Backend: Railway ($5/월)
Database: Supabase Free (500MB) → Pro ($25/월, 필요 시)
Redis: Upstash (무료)
총 비용: $5-30/월

데이터 최적화: 동일
예상 사용 기간: 10년 이상 (Pro 업그레이드 시)
```

### **시나리오 3: 대규모 확장 (100명 이상)**

```
Frontend: Vercel Pro ($20/월)
Backend: Railway ($20/월)
Database: Supabase Pro ($25/월)
Redis: Upstash (무료)
총 비용: $65/월

데이터 최적화: 동일
추가 고려: 데이터 아카이빙 (S3)
```

---

## 📋 **데이터 관리 체크리스트**

### **즉시 구현 (데이터 최적화)**

1. ✅ **주가 데이터 아카이빙**
   - 1년 이상 된 데이터 삭제 또는 아카이빙
   - Celery 태스크로 자동화

2. ✅ **재무 데이터 최적화**
   - 분기 데이터는 최근 2년만 유지
   - 연도별 데이터는 계속 유지

3. ✅ **메이트 분석 최적화**
   - 과거 계산 이력 삭제
   - 최신 분석만 유지

### **모니터링**

1. ✅ **데이터베이스 크기 모니터링**
   - 주기적으로 크기 확인
   - 400MB 도달 시 알림

2. ✅ **데이터 증가 속도 추적**
   - 월별 증가량 기록
   - 예상 용량 초과 시점 계산

---

## 🎯 **결론**

### **현재 권장 인프라 적정성: ✅ 적절함**

**이유:**
1. ✅ **데이터 최적화 시**: 221 MB (초기) → 10년 이상 충분
2. ✅ **비용 효율**: $5/월 (혼자 사용 시)
3. ✅ **확장 가능**: 필요 시 Supabase Pro ($25/월)로 업그레이드
4. ✅ **백업 자동**: Supabase Free도 7일 백업 제공

### **혼자 사용 시:**

1. ✅ **앱 개발 불필요**: 웹 앱으로 충분
2. ✅ **Supabase Free (500MB)**: 10년 이상 충분 (최적화 시)
3. ✅ **Railway $5/월**: 적절한 선택
4. ✅ **데이터 아카이빙**: 즉시 구현 권장

### **다음 단계:**

1. ✅ 데이터 아카이빙 스크립트 작성
2. ✅ 데이터베이스 크기 모니터링 설정
3. ✅ 정기적인 데이터 정리 (Celery 태스크)

---

**마지막 업데이트**: 2025.01.14

